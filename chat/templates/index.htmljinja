<!doctype html>
<html>
<head>
  <title>{{ title }}</title>
  <link rel="stylesheet" href="/assets/style.styl"></link>
  <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <script src="/assets/chat.coffee"></script>
  <script src="/assets/chat_controls.coffee"></script>
  <script src="/assets/channel_controls.coffee"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script charset="utf-8">

      $(document).ready(function(){
        chat = new Chat("ws://" + document.location.host + "/eventhub")
        chatControls = new ChatControls()
        chatControls.init()
        channelControls = new ChannelControls("{{ last_selected_channel }}")
        channelControls.init()
      })
      $(window).load(function() {
        chat.scrollToBottom(false)
      })
  </script>
</head>
<body>
  <div class="left-sidebar">
    <div class="logo-title">
      <div>{{ "".join(name_jumble[:2]) }}</div>
      <div>{{ "".join(name_jumble[2:]) }}</div>
    </div>
    <div class="channel-list-container">
      {% for channel in channels %}
        <button class="switch-channel channel {{ "current" if channel == last_selected_channel else "" }}"
          data-channel-name="{{ channel }}">{{ channel }}</button>
      {% endfor %}
      <div class="add-channel-container">
        <div class="plus-label">+</div>
        <input type="text" size="17" class="new-channel-name" />
      </div>
    </div>
  </div>
  <div class="main-content">
    <div class="chat-column">
      <div class="chat-controls">
        <button class="toggle-left-sidebar">⇤</button>
        <button class="toggle-right-sidebar">⇥</button>
        <div class="channel-name">{{ last_selected_channel }}</div>
      </div>
      <div class="chat-messages-container">
        {% for message in messages|reverse %}
        {{ render_template("chat_message.htmljinja",
                           message=markdown_renderer.render(message["message"] or " "),
                           author=message["author"],
                           message_id=message["_id"],
                           gravatar=message["gravatar"] or "static/anon.jpg")|safe }}
        {% endfor %}
      </div>
      <div class="input-container">
        <div class="chat-text-wrapper"><textarea class="chat-text"></textarea></div>
        <div class="input-controls">
          <button class="chat-submit">Send</button>
          <button class="chat-preview">Preview</button>
        </div>
      </div>
    </div>
    <div class="right-sidebar">
      <div class="user-container">
        <div class="user-data">
          <img height="18" width="18" class="gravatar" src="{{ avatar_url }}">
          <div class="user-name">{{ user_name }}</div>
          {% if authed %}
          <a href="/logout"><button class="logout">Logout</button></a>
          {% else %}
          <a href="/login" target="_blank"><button class="login">Login</button></a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</body>
</html>
